<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Identificador de S√≠laba T√≥nica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <style>
      /* Estilos b√°sicos */
      [x-cloak] {
        display: none !important;
      }
      .syllable {
        cursor: pointer;
        padding: 0.25rem 0.5rem;
        margin: 0.1rem;
        border-radius: 0.375rem; /* rounded-md */
        transition: all 0.2s ease-in-out;
        user-select: none;
        display: inline-block;
        font-weight: 500; /* font-medium */
      }
      .syllable:hover:not(.tonic, .correct, .incorrect, .checking) {
        background-color: #f3f4f6; /* gray-100 */
      }
      .word-container {
        min-height: 2.5rem; /* Para mantener la altura consistente */
      }
    </style>
  </head>
  <body class="bg-gray-50 p-4 min-h-screen" x-data="tonicSyllableIdentifier()">
    <h1 class="text-lg font-bold text-gray-800 mb-6 text-center">
      Identifica la S√≠laba T√≥nica üîä
    </h1>
    <p class="text-center text-sm text-gray-600 mb-8">
      Haz clic en la s√≠laba que consideres la **t√≥nica** en cada palabra.
    </p>

    <div
      class="max-w-4xl mx-auto p-4 bg-white rounded-xl shadow-lg border border-gray-200"
    >
      <div
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
        :class="{ 'pointer-events-none opacity-80': isChecking }"
      >
        <template x-for="word in words" :key="word.name">
          <div
            class="p-3 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow word-container"
          >
            <div class="flex flex-wrap justify-center">
              <template
                x-for="(syllable, index) in word.syllables"
                :key="index"
              >
                <span
                  class="syllable"
                  :class="{
                    'bg-blue-200 text-blue-900 border-2 border-blue-400': word.selectedIndex === index && !isChecking,
                    'bg-green-300 text-green-900 border-2 border-green-600 font-bold': isChecking && word.correctIndex === index,
                    'bg-red-300 text-red-900 border-2 border-red-600 font-bold': isChecking && word.selectedIndex === index && word.correctIndex !== index,
                    'text-gray-700': !isChecking && word.selectedIndex !== index,
                    'opacity-50': isChecking && word.selectedIndex !== index && word.correctIndex !== index,
                  }"
                  @click="selectSyllable(word, index)"
                  x-text="syllable"
                ></span>
              </template>
            </div>
            <p
              x-show="isChecking"
              class="text-xs text-center mt-2 font-semibold"
              :class="{
                'text-green-700': word.selectedIndex === word.correctIndex,
                'text-red-700': word.selectedIndex !== word.correctIndex,
                'text-yellow-700': word.selectedIndex === null,
              }"
              x-text="getFeedback(word)"
            ></p>
          </div>
        </template>
      </div>
    </div>

    <div class="mt-8 flex justify-center space-x-4">
      <button
        @click="isChecking ? resetExercise() : checkAnswers()"
        :disabled="!isChecking && words.filter(w => w.selectedIndex !== null).length < totalWords"
        class="py-3 px-6 rounded-lg font-semibold text-white transition-all duration-300 focus:outline-none focus:ring-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
        :class="{
          'bg-red-500 hover:bg-red-600 focus:ring-red-300': isChecking,
          'bg-blue-600 hover:bg-blue-700 focus:ring-blue-300': !isChecking && words.filter(w => w.selectedIndex !== null).length === totalWords,
        }"
        x-text="isChecking ? 'Reiniciar Ejercicio' : 'Corregir'"
      ></button>
    </div>

    <div
      x-show="isChecking"
      class="mt-6 p-4 text-center rounded-lg shadow-inner max-w-lg mx-auto border"
      :class="{
        'bg-green-100 text-green-800 border-green-400': totalScore === totalWords,
        'bg-yellow-100 text-yellow-800 border-yellow-400': totalScore > 0 && totalScore < totalWords,
        'bg-red-100 text-red-800 border-red-400': totalScore === 0
      }"
    >
      <h3
        class="font-bold text-lg mb-1"
        x-text="totalScore === totalWords ? '¬°Identificaci√≥n Perfecta! üåü' : (totalScore > 0 ? '¬°Buen intento! Revisa las incorrectas.' : 'Necesitas repasar la s√≠laba t√≥nica. üßê')"
      ></h3>
      <p class="text-sm">
        Puntuaci√≥n: <span class="font-bold" x-text="totalScore"></span> de
        <span x-text="totalWords"></span>.
      </p>
    </div>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("tonicSyllableIdentifier", () => ({
          // Estructura de palabras: [Palabra, [S√≠labas], √çndice de s√≠laba t√≥nica (desde 0)]
          initialWords: [
            { name: "√Årbol", syllables: ["√År", "bol"], correctIndex: 0 }, // Llana
            { name: "Reloj", syllables: ["Re", "loj"], correctIndex: 1 }, // Aguda
            {
              name: "C√°psula",
              syllables: ["C√°p", "su", "la"],
              correctIndex: 0,
            }, // Esdr√∫jula
            { name: "Mesa", syllables: ["Me", "sa"], correctIndex: 0 }, // Llana
            { name: "Bal√≥n", syllables: ["Ba", "l√≥n"], correctIndex: 1 }, // Aguda
            { name: "R√°pido", syllables: ["R√°", "pi", "do"], correctIndex: 0 }, // Esdr√∫jula
            { name: "Libro", syllables: ["Li", "bro"], correctIndex: 0 }, // Llana
            { name: "Beb√©", syllables: ["Be", "b√©"], correctIndex: 1 }, // Aguda
            {
              name: "Geograf√≠a",
              syllables: ["Ge", "o", "gra", "f√≠", "a"],
              correctIndex: 3,
            }, // Llana (con hiato)
            { name: "L√°piz", syllables: ["L√°", "piz"], correctIndex: 0 }, // Llana
            { name: "Amor", syllables: ["A", "mor"], correctIndex: 1 }, // Aguda
            {
              name: "C√°ntaro",
              syllables: ["C√°n", "ta", "ro"],
              correctIndex: 0,
            }, // Esdr√∫jula
            {
              name: "Ventana",
              syllables: ["Ven", "ta", "na"],
              correctIndex: 1,
            }, // Llana
            { name: "Canci√≥n", syllables: ["Can", "ci√≥n"], correctIndex: 1 }, // Aguda
            {
              name: "Ox√≠geno",
              syllables: ["O", "x√≠", "ge", "no"],
              correctIndex: 1,
            }, // Esdr√∫jula
            {
              name: "Ordenador",
              syllables: ["Or", "de", "na", "dor"],
              correctIndex: 3,
            }, // Aguda
            { name: "F√°cil", syllables: ["F√°", "cil"], correctIndex: 0 }, // Llana
            {
              name: "Esdr√∫jula",
              syllables: ["Es", "dr√∫", "ju", "la"],
              correctIndex: 1,
            }, // Esdr√∫jula
            { name: "Ciudad", syllables: ["Ciu", "dad"], correctIndex: 1 }, // Aguda (diptongo)
            {
              name: "Tel√©fono",
              syllables: ["Te", "l√©", "fo", "no"],
              correctIndex: 1,
            }, // Esdr√∫jula
          ],
          words: [],
          isChecking: false,

          get totalWords() {
            return this.initialWords.length;
          },

          get totalScore() {
            return this.words.filter(
              (word) => word.selectedIndex === word.correctIndex,
            ).length;
          },

          // Funci√≥n para desordenar un array (Fisher-Yates)
          shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
          },

          init() {
            this.resetExercise();
          },

          resetExercise() {
            const shuffledWords = this.shuffleArray([...this.initialWords]);
            // Clona y a√±ade el estado de selecci√≥n
            this.words = shuffledWords.map((word) => ({
              ...word,
              selectedIndex: null, // √çndice de la s√≠laba seleccionada por el usuario
            }));
            this.isChecking = false;
          },

          selectSyllable(word, index) {
            if (this.isChecking) return;
            word.selectedIndex = word.selectedIndex === index ? null : index;
          },

          checkAnswers() {
            this.isChecking = true;
          },

          getFeedback(word) {
            if (word.selectedIndex === null) {
              return "Sin seleccionar";
            }
            return word.selectedIndex === word.correctIndex
              ? "¬°Correcto! ‚úÖ"
              : `Incorrecto. La t√≥nica es: ${word.syllables[word.correctIndex]}`;
          },
        }));
      });
    </script>
  </body>
</html>
