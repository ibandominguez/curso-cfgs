<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gr√°ficas de Deportes de Alumnos (Actualizaci√≥n Autom√°tica)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>

    <style>
      [x-cloak] {
        display: none !important;
      }
      .chart-container {
        min-height: 300px;
      }
    </style>
  </head>
  <body class="bg-gray-50 p-4 min-h-screen">
    <div
      x-data="sportsData()"
      x-init="initGoogleCharts()"
      class="max-w-4xl mx-auto"
    >
      <h1 class="text-2xl font-bold text-gray-800 mb-8 text-center">
        Deportes de Alumnos üèÄüèä‚Äç‚ôÇÔ∏è‚öΩ (Actualizaci√≥n Autom√°tica)
      </h1>

      <div
        class="p-5 bg-white rounded-xl shadow-lg border border-gray-200 mb-8"
      >
        <h2 class="text-xl font-semibold mb-4 text-gray-700">
          Editar Participaci√≥n
        </h2>
        <div class="space-y-3">
          <template x-for="sport in data" :key="sport.label">
            <div class="flex items-center space-x-3">
              <label
                class="flex-1 text-gray-600 font-medium"
                x-text="sport.label + ':'"
              ></label>
              <input
                type="number"
                min="0"
                class="w-20 p-2 border border-gray-300 rounded-md text-center focus:ring-blue-500 focus:border-blue-500"
                x-model.number.debounce.300ms="sport.value"
                placeholder="0"
              />
            </div>
          </template>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="p-4 bg-white rounded-xl shadow-lg border border-gray-200">
          <h2 class="text-lg font-semibold mb-3 text-center text-gray-700">
            Gr√°fico de Barras
          </h2>
          <div id="barChartContainer" class="chart-container"></div>
        </div>

        <div class="p-4 bg-white rounded-xl shadow-lg border border-gray-200">
          <h2 class="text-lg font-semibold mb-3 text-center text-gray-700">
            Gr√°fico de Sectores
          </h2>
          <div id="pieChartContainer" class="chart-container"></div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("sportsData", () => ({
          data: [
            { label: "Baloncesto", value: 12, color: "#3b82f6" },
            { label: "Nataci√≥n", value: 3, color: "#10b981" },
            { label: "F√∫tbol", value: 9, color: "#ef4444" },
            { label: "Sin deporte", value: 6, color: "#6b7280" },
          ],

          // Paso 1: Inicializa Google Charts y establece el watcher
          initGoogleCharts() {
            google.charts.load("current", { packages: ["corechart"] });

            // Llama a drawCharts al cargar.
            google.charts.setOnLoadCallback(() => this.drawCharts());

            // CLAVE: Watcher de Alpine.js para redibujar en cada cambio en `data`
            // Alpine detecta cualquier cambio en el array `data` (gracias a x-model.debounce)
            this.$watch("data", (newVal, oldVal) => {
              // Solo redibujar si Google Charts ya est√° cargado
              if (typeof google.visualization !== "undefined") {
                this.drawCharts();
              }
            });
          },

          // Paso 2: Formatea los datos (Sin cambios)
          get googleChartData() {
            const chartArray = [["Deporte", "Alumnos"]];
            this.data.forEach((item) => {
              const value = Number(item.value) || 0;
              chartArray.push([item.label, value]);
            });
            return google.visualization.arrayToDataTable(chartArray);
          },

          // Paso 3: Dibuja/Actualiza los gr√°ficos (Sin cambios)
          drawCharts() {
            const colors = this.data.map((d) => d.color);

            // --- GR√ÅFICO DE BARRAS (ColumnChart) ---
            const barOptions = {
              title: "Alumnos por Deporte (Barras)",
              legend: { position: "none" },
              colors: colors,
              hAxis: { title: "Deporte" },
              vAxis: { title: "Cantidad de Alumnos", minValue: 0, format: "0" },
              chartArea: { left: 50, top: 20, width: "80%", height: "80%" },
            };

            const barChart = new google.visualization.ColumnChart(
              document.getElementById("barChartContainer"),
            );
            barChart.draw(this.googleChartData, barOptions);

            // --- GR√ÅFICO DE SECTORES (PieChart) ---
            const pieOptions = {
              title: "Distribuci√≥n de Deportes",
              is3D: true,
              colors: colors,
              chartArea: { left: 10, top: 40, width: "90%", height: "85%" },
            };

            const pieChart = new google.visualization.PieChart(
              document.getElementById("pieChartContainer"),
            );
            pieChart.draw(this.googleChartData, pieOptions);
          },
        }));
      });
    </script>
  </body>
</html>
